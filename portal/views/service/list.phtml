<?php
$requestCollection = $this->var('requestCollection', []);
?>

<div id="request-list" class="card">
    <div class="table-toolbar flex flex-right" style="align-items:center;gap:.5rem;margin-bottom:.5rem">
        <div class="button-top-set">
            <a class="btn" href="/?q=service/add">Request Service</a>
            <a class="btn brand-green disabled" href="/?q=service/export">Export</a>
        </div>
    </div>

    
        <table class="grid">
            <thead>
                <tr>
                    <th>
                        <input class="tbl-filter inline-search" name="f_name" value="<?= htmlspecialchars($nameFilter) ?>" placeholder="Parcel name">
                    </th>
                    <th><input class="tbl-filter inline-search" name="f_address" value="<?= htmlspecialchars($addrFilter) ?>" placeholder="Address"></th>
                    <th>Blocks</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($parcelCollection as $parcelModel):
                    $p = $parcelModel->getData();
                    $addr = trim($p['street'] . ' ' . $p['city'] . ' ' . $p['state'] . ' ' . $p['zip']); ?>
                    <tr>
                        <td><?= htmlspecialchars($p['name']) ?></td>
                        <td><?= htmlspecialchars($addr) ?></td>
                        <td>
                            <?php
                            echo $parcelModel->getBlocks()->count();
                            ?>
                        </td>
                        <td>
                            <div class="action-wrap" style="position:relative">
                                <button class="action-btn">â‹®</button>
                                <div class="actions-menu">
                                    <a href="/?q=parcel/edit&id=<?= $p['id'] ?>">Edit</a>
                                    <div class="sep"></div>
                                    <a class="hover-brand-green" href="/?q=serviceRequest/request&parcel=<?= $p['id'] ?>">Request Service</a>
                                    <a class="hover-brand-green" href="#" onclick="alert('Coming soon')">Self Tracking</a>
                                    <div class="sep"></div>
                                    <a href="/?q=block/disableAll&parcel=<?= $p['id'] ?>" class="disable">Disable</a>
                                    <a href="/?q=parcel/remove&id=<?= $p['id'] ?>" class="danger">Delete</a>
                                </div>
                            </div>
                        </td>
                    </tr>
                <?php endforeach ?>
                <?php if (!$parcels): ?>
                    <tr>
                        <td colspan="6" style="text-align:center;padding:1rem">No parcels found.</td>
                    </tr>
                <?php endif ?>
            </tbody>
        </table>

</div>